# http://pm2.keymetrics.io/docs/usage/cluster-mode/

apps:
  # Web 平台
  - script: app.js
    name: WebApp
    exec_mode: fork
    exec_interpreter: './node_modules/babel-cli/bin/babel-node.js'
    max_memory_restart: 600M
    env:
      NODE_ENV: production
    env_production:
      NODE_ENV: production

  # 力士平台 component_access_token 更新
  - script: mqworks/hercules_update_access_token_workers.js
    name: hercules_UpdateAccessToken
    exec_mode: fork
    exec_interpreter: './node_modules/babel-cli/bin/babel-node.js'
    max_memory_restart: 50M
    env:
      NODE_ENV: production
    env_production:
      NODE_ENV: production

  # 力士平台 component_access_token 更新成功
  - script: mqworks/hercules_update_access_token_success_workers.js
    name: hercules_UpdateAccessTokenSuccess
    exec_mode: fork
    exec_interpreter: './node_modules/babel-cli/bin/babel-node.js'
    max_memory_restart: 50M
    env:
      NODE_ENV: production
    env_production:
      NODE_ENV: production

  # 代码提交
  - script: mqworks/hercules_code_commit_workers.js
    name: hercules_CodeCommit
    exec_mode: cluster
    instances: 2
    exec_interpreter: './node_modules/babel-cli/bin/babel-node.js'
    max_memory_restart: 100M
    env:
      NODE_ENV: production
    env_production:
      NODE_ENV: production

  # 代码审核
  - script: mqworks/hercules_code_submit_audit_workers.js
    name: hercules_WxliteCodeSubmitAudit
    exec_mode: cluster
    instances: 0
    exec_interpreter: './node_modules/babel-cli/bin/babel-node.js'
    max_memory_restart: 200M
    env:
      NODE_ENV: production
    env_production:
      NODE_ENV: production

  # 代码发布
  - script: mqworks/hercules_code_release_workers.js
    name: hercules_WxliteCodeRelease
    exec_mode: fork
    exec_interpreter: './node_modules/babel-cli/bin/babel-node.js'
    max_memory_restart: 50M
    env:
      NODE_ENV: production
    env_production:
      NODE_ENV: production

  # 用户授权完成
  - script: mqworks/wx_authorized_workers.js
    name: weixin_Authorizerd
    exec_mode: cluster
    instances: 2
    exec_interpreter: './node_modules/babel-cli/bin/babel-node.js'
    max_memory_restart: 100M
    env:
      NODE_ENV: production
    env_production:
      NODE_ENV: production

  # 用户取消授权
  - script: mqworks/wx_unauthorize_workers.js
    name: weixin_UnAuthorize
    exec_mode: fork
    exec_interpreter: './node_modules/babel-cli/bin/babel-node.js'
    max_memory_restart: 50M
    env:
      NODE_ENV: production
    env_production:
      NODE_ENV: production

  # 用户授权更新
  - script: mqworks/wx_updateauthorize_workers.js
    name: weixin_UpdateAuthorize
    exec_mode: fork
    exec_interpreter: './node_modules/babel-cli/bin/babel-node.js'
    max_memory_restart: 50M
    env:
      NODE_ENV: production
    env_production:
      NODE_ENV: production

  # 刷新令牌循环
  - script: mqworks/hercules_refresh_authorizer_access_token_workers.js
    name: hercules_RefreshAuthorizerAccessToken
    exec_mode: cluster
    cmd: .
    instances: 4
    exec_interpreter: './node_modules/babel-cli/bin/babel-node.js'
    max_memory_restart: 200M
    env:
      NODE_ENV: production
    env_production:
      NODE_ENV: production
